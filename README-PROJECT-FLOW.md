# README — Avivi Solutions Pension Feedback Automation Pilot

## מהות ומטרת הפרויקט
**מטרה**: ליצור מערכת אוטומטית לעיבוד, זיהוי וטיפול בשגיאות בקבצי היזון חוזר פנסיוני. המערכת תנתח אקסלים מהמסלקה, תמפה שגיאות לפי קובץ מיפוי, תיצור טיוטות מייל אוטומטיות ב-Gmail, ותרכז סטטיסטיקות ודוחות בקרה למנהלת תיק.

## מהלך עבודה עיקרי בפיילוט
1. **קליטת קבצי היזון חוזר מהמסלקה** (אקסל): כולל עשרות עד אלפי רשומות לעובדים מרובי מעסיקים.
2. **סינון לשורת היזון חוזר אחרון בלבד** (עמודה AG או מקבילה).
3. **סיכום לפי טבלת ציר**:
   - ריכוז סך העובדים (ת.ז.) לכל (מעסיק–קופה–קוד שגיאה)
4. **מיפוי קוד שגיאה לטיפול (ErrorCodeV4Id)**
   - לפי טבלת "קודי שגיאה מקרים ותגובות", כל קוד שגיאה מקבל פעולה מוגדרת (מייל/אוטומציה/העברה לאנושי)
5. **הפקת בקרה ודוחות**
   - הפקת רשימת תקלות ממוקדת — סטטוסי טיפול, רמת דחיפות
   - טבלת סיכום: כמה בעיות יש, אילו נפתרו אוטומטית ומה מחכה למנהלת תיק
6. **טיוטות מייל אוטומטיות ב-Gmail** (לא שליחה):
   - הכנה אוטומטית לפי תבניות בקובץ מיפוי
   - מנהלת תיק בודקת/מאשרת ידנית טרם שליחה החוצה

## דגשים ואילוצים עיקריים
- **PII & Privacy**: הנתונים רגישים ואין להעבירם החוצה. נדרשת אנונימיזציה/פסאודונימיזציה בעת שימוש בכל כלי ענן.
- **קשר בין רשומות**: מזהה ייחודי = שילוב של מספר מעסיק, ח.פ קופה, קוד קופה, ת.ז. עובד. לכל שילוב עשויה להיות שורת שגיאה ייחודית.
- **גמישות מיפוי ועתיד להתרחבות**: תשתית תאפשר מעבר לאינטגרציה מלאה (API) ודשבורד בעתיד.
- **עדיפות לאוטומציה - אך נדרשת בקרת אנוש בתהליכים רגישים** (כגון מיילים יצוגיים, דיווח לרגולטור).

## אתגרים שזוהו עד כה
- טיפול בשגיאות רב-משתתפים (אותה שגיאה מרובת ת.ז/עובדים)
- קליטת קבצים במבנים שונים (עברית/אנגלית)
- שדה נושא/גוף דינמי למיילים (שיבוץ משתנים מהנתונים)
- סקירה ואישור טרם שליחה (לא הכל אוטומטי)

## המשך עבודה
- השלמת אפיון טבלאות + תרשים WorkFlow מלא
- בניית דוגמאות לפלטים ודוחות
- כתיבת סקריפט אוטומציה להפקת טיוטות Gmail
- הרחבה לאינטגרציות עתידיות ודשבורד

---

> **מסמך זה נועד ללוות את הפרויקט — כל משימה, פיתוח או אפיון אמורים לעדכן או להסתמך עליו כבסיס הקשר! מוודא שכל עבודתנו מסונכרנת עם מהות הלקוח והאתגרים.**

## סטטוס נוכחי וזרימת עבודות
- **תרשים פעולות עיקרי:**  
  1. קריאת קבצי Feedback (Excel) – מעדכנת השבוע האחרון וההיסטוריה (`feedback report 122025.xlsx`, `feedback report DS.xlsx`).  
  2. זיהוי עמודות קריטיות וניתוח מודל הנתונים (CustomerNumber, קודים, ת.ז., סטטוסים, `StatusLastUpdateDate`).  
  3. מיפוי שגיאות לפי `error_code_mapping_final.xlsx` תוך התייחסות ל־override לקודים 4,5,15,93.  
  4. חישוב counter שבועי רצוף על סמך תאריך הסטטוס (לשימוש פנימי בלבד).  
  5. הפקת טיוטות Gmail לפי תבניות (ללא שליחה אוטומטית) ובליווי דוח בקרה.  
  6. כלים לצפייה בסטטיסטיקה: סקירה של כמות שגיאות, פילוחים לפי קופה/מעסיק/משך זמן, ויצוא דוח בקרה לדשבורד או למייל.
- **מיקוד הפיילוט:** אדפטציה של `pilot_engine.py` כדי להתמודד עם קבצים בעברית/אנגלית, ליצור `Pilot_Results_v2.xlsx` מוכן ליצירת טיוטות ולשמור על מעקב נראות פנימית (counter, override, אחראיות).  
- **שכבת אוטומציה:** עבודה ב־n8n שמתחילה בקריאה מ־Google Drive + Spreadsheet node, ממשיכה ב־Code node (Python/JS) לחישובים, ומסתיימת ביצירת טיוטות Gmail (drafts.create) ולוג נלווה.

## נקודות פתוחות ומתודולוגיה מול “השקט שלך”
1. **API פורטל ארגוני:** נדרש אפיון של `GetFeedbackData` (שדות, פורמט, סינון `FeedbackStatus` ו־`UpdateDate`, הסטוריית סטטוס). גם יש להבין איפה נשמרים `CustomerNumber`, `KodKupa_*`, `MISPAR_MEZAHE_OVED`.  
2. **היסטוריית קודים מיוחדים:** קודים 4,5,15,93 מחייבים בדיקה נוספת (האם הייתה קליטה תקינה בעבר). נדרש Endpoint כדי למצוא את הסטטוסים בחודשים קודמים ולבחור האם לשלוח מייל למעסיק או לגוף המוסדי.  
3. **Contact Info / Gmail:** איפה משיגים כתובות מייל לשולחים (עוד API או מאגר פנימי)? נרצה להוסיף פרמטרים גם לתבניות (שם מנהלת תיק, קובץ מצורף).  
4. **PostAnalyticsReport / Salesforce:** נדרש להבין איזה פורמט ה־API מצפה לקבל (JSON/Excel) וכיצד מדווחים סטטיסטיקות לגורם הפנימי. האם מעדכנים גם Salesforce כדי להראות מנהלות תיק את סטטוס הטיפול?  
5. **אבטחת מידע ו־Static IP:** נדרש לבצע חיבור מאובטח עם כתובת IP סטטית, לבדוק גישה רק ל־SMTP (Draft-only scope) ולשמור על נתוני PII בהתאם למדיניות.  
6. **לוג וטראקים:** נדאג לרשום כל יצירת טיוטה (גוף, נושא, קבצים), כל הפעלת סקריפט וסטטיסטיקת שגיאות לצורך QA.
